<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>35mm Film Scanner</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üì∑ 35mm Film Scanner</h1>
            <div class="connection-status">
                <span id="arduino-status" class="status-badge disconnected">Arduino</span>
                <span id="camera-status" class="status-badge disconnected">Camera</span>
            </div>
        </header>

        <!-- Status Panel -->
        <section class="status-panel">
            <div class="status-grid">
                <div class="status-item">
                    <label>Roll:</label>
                    <span id="roll-name">Not set</span>
                </div>
                <div class="status-item">
                    <label>Strip:</label>
                    <span id="strip-count">0</span>
                </div>
                <div class="status-item">
                    <label>Frame:</label>
                    <span id="frame-count">0</span>
                </div>
                <div class="status-item">
                    <label>Position:</label>
                    <span id="position">0</span>
                </div>
                <div class="status-item">
                    <label>Mode:</label>
                    <span id="mode">MANUAL</span>
                </div>
                <div class="status-item">
                    <label>Advance:</label>
                    <span id="frame-advance">Not set</span>
                </div>
            </div>
            <div class="status-message" id="status-msg">Ready</div>
        </section>

        <!-- Roll Management -->
        <section class="panel">
            <h2>Roll Management</h2>
            <div class="input-group">
                <input type="text" id="roll-name-input" placeholder="Enter roll name...">
                <button class="btn btn-primary" onclick="createRoll()">New Roll</button>
            </div>
        </section>

        <!-- Camera Preview -->
        <section class="panel">
            <h2>Camera Preview</h2>
            <div class="preview-controls">
                <button class="btn btn-primary btn-large" id="preview-btn" onclick="capturePreview()">
                    üì∑ Get Preview
                </button>
            </div>
            <div id="preview-container" style="display: none;">
                <img id="preview-image" src="" alt="Camera Preview">
                <div class="preview-info">
                    <span id="preview-timestamp"></span>
                    <button class="btn btn-small btn-secondary" onclick="toggleInvert()">
                        <span id="invert-text">Invert</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Calibration Section -->
        <section class="panel" id="calibration-panel">
            <h2>Calibration</h2>
            <p class="help-text">Strip 1: Position frame 1, capture, then position frame 2 and capture to learn frame spacing.</p>
            <div class="calibration-steps" id="calibration-steps">
                <button class="btn btn-large btn-warning" onclick="startCalibration()">Start Calibration</button>
            </div>
        </section>

        <!-- Strip Management -->
        <section class="panel" id="strip-panel">
            <h2>Strip Management</h2>
            <div class="calibration-steps" id="strip-steps">
                <button class="btn btn-large btn-success" onclick="startNewStrip()">Start New Strip</button>
            </div>
        </section>

        <!-- Motor Controls -->
        <section class="panel">
            <h2>Motor Controls</h2>
            <div class="controls-grid">
                <button class="btn btn-secondary motor-btn" 
                        data-direction="backward" 
                        data-size="fine">
                    ‚á¶ Fine Back
                </button>
                <button class="btn btn-secondary motor-btn" 
                        data-direction="forward" 
                        data-size="fine">
                    Fine Forward ‚á®
                </button>
                <button class="btn btn-secondary motor-btn" 
                        data-direction="backward" 
                        data-size="coarse">
                    ‚á¶‚á¶ Coarse Back
                </button>
                <button class="btn btn-secondary motor-btn" 
                        data-direction="forward" 
                        data-size="coarse">
                    Coarse Forward ‚á®‚á®
                </button>
                <button class="btn btn-secondary" onclick="backupFrame()">
                    ‚Ü∂ Full Frame Back
                </button>
                <button class="btn btn-secondary" onclick="advanceFrame()">
                    Full Frame Forward ‚Ü∑
                </button>
            </div>
            <div class="control-options">
                <button class="btn btn-secondary" onclick="zeroPosition()">
                    Zero Position
                </button>
            </div>
        </section>

        <!-- Camera Controls -->
        <section class="panel">
            <h2>Camera Controls</h2>
            <div class="camera-controls">
                <button class="btn btn-success btn-large btn-capture" onclick="capture()">
                    üì∏ CAPTURE
                </button>
            </div>
            <div class="control-options">
                <button class="btn btn-secondary" onclick="toggleMode()">
                    Mode: <span id="mode-display">MANUAL</span>
                </button>
                <button class="btn btn-secondary" onclick="toggleAutoAdvance()">
                    Auto-Advance: <span id="auto-advance">ON</span>
                </button>
            </div>
        </section>

        <!-- Settings Panel -->
        <section class="panel">
            <h2>‚öôÔ∏è Settings</h2>
            
            <div class="settings-section">
                <h3>Motor Step Sizes</h3>
                <div class="setting-group">
                    <label for="fine-step-input">Fine Step:</label>
                    <input type="number" id="fine-step-input" min="1" max="100" value="8">
                    <span class="setting-unit">steps</span>
                </div>
                <div class="setting-group">
                    <label for="coarse-step-input">Coarse Step:</label>
                    <input type="number" id="coarse-step-input" min="1" max="500" value="192">
                    <span class="setting-unit">steps</span>
                </div>
                <button class="btn btn-primary" onclick="updateStepSizes()">
                    Apply Step Sizes
                </button>
            </div>

            <div class="settings-section">
                <h3>Auto-Refresh Preview</h3>
                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="auto-refresh-toggle" onchange="toggleAutoRefresh()">
                        Enable Auto-Refresh
                    </label>
                </div>
                <div class="setting-group">
                    <label for="refresh-interval">Interval:</label>
                    <input type="range" id="refresh-interval" min="100" max="5000" step="100" value="1000">
                    <span id="refresh-interval-display">1000 ms</span>
                </div>
            </div>

            <div class="settings-section">
                <h3>System</h3>
                <div class="control-options">
                    <button class="btn btn-secondary" onclick="connectArduino()">
                        Reconnect Arduino
                    </button>
                    <button class="btn btn-warning" onclick="testCapture()">
                        üß™ Test Camera Capture
                    </button>
                </div>
                <div class="help-text">
                    Test Capture: Takes a test photo without affecting frame count.
                </div>
            </div>
        </section>

        <footer>
            <p>Access from mobile: http://&lt;computer-ip&gt;:5000</p>
        </footer>
    </div>

    <!-- Include Socket.IO and app JavaScript -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>

